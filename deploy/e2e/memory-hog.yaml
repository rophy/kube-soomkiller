apiVersion: batch/v1
kind: Job
metadata:
  name: memory-hog
  namespace: kube-soomkiller
  labels:
    app: memory-hog
spec:
  backoffLimit: 0  # Don't retry on failure
  template:
    metadata:
      labels:
        app: memory-hog
    spec:
      # Run on worker nodes (same as soomkiller)
      nodeSelector:
        node-role.kubernetes.io/worker: "true"
      containers:
        - name: memory-hog
          image: polinux/stress
          # Allocate 350MB against 256MB limit to force swap usage
          command: ["stress", "--vm", "1", "--vm-bytes", "350M", "--vm-keep", "--vm-hang", "0"]
          resources:
            requests:
              memory: 128Mi
            limits:
              memory: 256Mi  # Burstable QoS (requests < limits enables swap)
      restartPolicy: Never
